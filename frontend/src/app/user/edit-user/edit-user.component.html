<h1 [translate]="'user.edit.title.' + mode"></h1>

<form [formGroup]="form" (ngSubmit)="save()">
  <div class="form-group">
    <label for="name" translate="user.edit.name"></label>
    <input class="form-control" formControlName="name" id="name" />
    <val-errors controlName="name" [label]="'user.edit.name-error-label' | translate"></val-errors>
    <small class="form-text text-muted" [innerHTML]="'user.edit.name-help' | translate: { keycloakUrl: keycloakUrl }"></small>
  </div>

  <div class="form-group">
    <label translate="user.edit.permissions"></label>

    <div formArrayName="permissions" class="ml-2">
      <div *ngFor="let permission of allPermissions; index as index" class="form-check" [formGroupName]="index">
        <input formControlName="selected" class="form-check-input" type="checkbox" [id]="'permission-' + permission" />
        <label class="form-check-label" [for]="'permission-' + permission">
          {{ permission | permissionEnum }}
        </label>
      </div>
    </div>
  </div>

  <div class="form-group">
    <label for="accession-holder" translate="user.edit.accession-holder"></label>
    <select class="form-control custom-select" formControlName="accessionHolderId" id="accession-holder">
      <option [ngValue]="null"></option>
      <optgroup *ngFor="let group of grcOptionGroups" [label]="group.name">
        <option *ngFor="let accessionHolder of group.accessionHolders" [ngValue]="accessionHolder.id">
          <ng-container *ngIf="form.value.accessionHolderId === accessionHolder.id; else notSelected">
            {{ accessionHolder.grc.name }} - {{ accessionHolder.name }}
          </ng-container>
          <ng-template #notSelected>{{ accessionHolder.name }}</ng-template>
        </option>
      </optgroup>
    </select>
    <val-errors controlName="accessionHolderId" [label]="'user.edit.accession-holder-error-label' | translate"></val-errors>
    <small class="form-text text-muted" translate="user.edit.accession-holder-help"></small>
  </div>

  <div>
    <button class="btn btn-primary mr-2" translate="user.edit.save" id="save-button"></button>
    <a routerLink="/users" class="btn btn-danger" translate="user.edit.cancel"></a>
  </div>
</form>
