<form [formGroup]="form" (ngSubmit)="save()">
  <div formArrayName="items" class="scrolling-accessions mb-2">
    @for (itemGroup of itemGroups.controls; track itemGroup) {
      <div [formGroupName]="$index" class="my-2 edit-order-item">
        <div class="d-flex">
          <div class="flex-grow-1 me-2">
            <div class="row g-1">
              <div class="col-lg-3">
                <label class="visually-hidden" [for]="'name-' + $index" translate="order.edit-order.name"></label>
                <input
                  #name
                  formControlName="name"
                  class="form-control form-control-sm"
                  [id]="'name-' + $index"
                  [placeholder]="'order.edit-order.name' | translate"
                />
                <val-errors controlName="name" [label]="'order.edit-order.name-error-label' | translate" />
              </div>
              <div class="col-lg-4">
                <label class="visually-hidden" [for]="'identifier-' + $index" translate="order.edit-order.name"></label>
                <input
                  formControlName="identifier"
                  class="form-control form-control-sm"
                  [id]="'identifier-' + $index"
                  [placeholder]="'order.edit-order.identifier' | translate"
                />
                <val-errors controlName="identifier" [label]="'order.edit-order.identifier-error-label' | translate" />
              </div>
              <div class="col-lg-2">
                <label class="visually-hidden" [for]="'quantity-' + $index" translate="order.edit-order.quantity"></label>
                <input
                  formControlName="quantity"
                  type="number"
                  class="form-control form-control-sm"
                  [id]="'quantity-' + $index"
                  [placeholder]="'order.edit-order.quantity' | translate"
                  min="1"
                />
                <val-errors controlName="quantity" [label]="'order.edit-order.quantity-error-label' | translate" />
              </div>
              <div class="col-lg-3">
                <label class="visually-hidden" [for]="'unit-' + $index" translate="order.edit-order.unit"></label>
                <input
                  formControlName="unit"
                  class="form-control form-control-sm"
                  [id]="'unit-' + $index"
                  [placeholder]="'order.edit-order.unit' | translate"
                />
              </div>
            </div>
          </div>
          <div>
            <button
              (click)="delete($index)"
              type="button"
              class="ms-auto btn btn-sm btn-outline-danger delete-order-item"
              [disabled]="itemGroups.length === 1"
            >
              <fa-icon [icon]="deleteIcon" />
              <span class="visually-hidden" translate="order.edit-order.delete-accession"></span>
            </button>
          </div>
        </div>
        <hr class="d-lg-none my-1" />
      </div>
    }
  </div>
  <div class="d-flex">
    <div>
      <button (click)="addItem()" type="button" class="btn btn-sm btn-outline-secondary me-2" id="add-item-button">
        <fa-icon [icon]="addItemIcon" />
        <span class="visually-hidden" translate="order.edit-order.add-accession"></span>
      </button>
      <button (click)="openCsvModal()" type="button" class="btn btn-sm btn-outline-secondary" id="csv-button">
        <fa-icon [icon]="csvIcon" />
        <span class="visually-hidden" translate="order.edit-order.csv"></span>
      </button>
    </div>
    <div class="flex-grow-1 text-end">
      <button class="btn btn-sm btn-primary me-2" translate="order.edit-order.save" id="save-button"></button>
      <button
        type="button"
        class="btn btn-sm btn-danger"
        (click)="cancel()"
        translate="order.edit-order.cancel"
        id="cancel-button"
      ></button>
    </div>
  </div>
</form>
